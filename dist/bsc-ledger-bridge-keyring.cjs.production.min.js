"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var e=require("events"),r=t(require("hdkey")),n=t(require("ethereumjs-util")),i=t(require("@ledgerhq/hw-transport-webusb")),a=t(require("@ledgerhq/hw-app-eth")),o=require("@ledgerhq/hw-app-eth/erc20");function s(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function u(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){s(a,n,i,o,u,"next",t)}function u(t){s(a,n,i,o,u,"throw",t)}o(void 0)}))}}function c(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var h=function(t,e){return function(t){var e=function(t){var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var i=Object.create((e&&e.prototype instanceof f?e:f).prototype),a=new b(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=w(o,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var h={};function f(){}function p(){}function d(){}var l={};l[i]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(_([])));v&&v!==e&&r.call(v,i)&&(l=v);var m=d.prototype=f.prototype=Object.create(l);function y(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){var n;this._invoke=function(i,a){function o(){return new e((function(n,o){!function n(i,a,o,s){var u=c(t[i],t,a);if("throw"!==u.type){var h=u.arg,f=h.value;return f&&"object"==typeof f&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):e.resolve(f).then((function(t){h.value=t,o(h)}),(function(t){return n("throw",t,o,s)}))}s(u.arg)}(i,a,n,o)}))}return n=n?n.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return h;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var n=c(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,h;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function b(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function _(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:L}}function L(){return{value:void 0,done:!0}}return p.prototype=m.constructor=d,d.constructor=p,p.displayName=s(d,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,s(t,o,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},y(x.prototype),x.prototype[a]=function(){return this},t.AsyncIterator=x,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new x(u(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},y(m),s(m,o,"Generator"),m[i]=function(){return this},m.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=_,b.prototype={constructor:b,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return o.type="throw",o.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:_(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}(e={exports:{}}),e.exports}(),f="Ledger Hardware",p={ropsten:"http://api-ropsten.etherscan.io",kovan:"http://api-kovan.etherscan.io",rinkeby:"https://api-rinkeby.etherscan.io",mainnet:"https://api.etherscan.io"},d=function(t){function e(e){var n;return void 0===e&&(e={}),(n=t.call(this)||this).accountDetails={},n.bridgeUrl=null,n.type=f,n.page=0,n.perPage=5,n.unlockedAccount=0,n.hdk=new r,n.paths={},n.iframe=null,n.network="mainnet",n.implementFullBIP44=!1,n.deserialize(e),n.iframeLoaded=!1,n._setupIframe(),n}c(e,t);var i=e.prototype;return i.serialize=function(){return Promise.resolve({hdPath:this.hdPath,accounts:this.accounts,accountDetails:this.accountDetails,bridgeUrl:this.bridgeUrl,implementFullBIP44:!1})},i.deserialize=function(t){var e=this;return void 0===t&&(t={}),this.hdPath=t.hdPath||"m/44'/60'/0'",this.bridgeUrl=t.bridgeUrl||"https://metamask.github.io/eth-ledger-bridge-keyring",this.accounts=t.accounts||[],this.accountDetails=t.accountDetails||{},this.implementFullBIP44=t.implementFullBIP44||!1,this.accounts=this.accounts.filter((function(t){return Object.keys(e.accountDetails).includes(n.toChecksumAddress(t))})),Promise.resolve()},i.isUnlocked=function(){return Boolean(this.hdk&&this.hdk.publicKey)},i.setAccountToUnlock=function(t){this.unlockedAccount=parseInt(t,10)},i.setHdPath=function(t){this.hdPath!==t&&(this.hdk=new r),this.hdPath=t},i.unlock=function(t){var e=this;if(this.isUnlocked()&&!t)return Promise.resolve("already unlocked");var r=t?this._toLedgerPath(t):this.hdPath;return new Promise((function(t,n){e._sendMessage({action:"ledger-unlock",params:{hdPath:r}},(function(r){var i=r.payload;r.success?(e.hdk.publicKey=Buffer.from(i.publicKey,"hex"),e.hdk.chainCode=Buffer.from(i.chainCode,"hex"),t(i.address)):n(i.error||"Unknown error")}))}))},i.getFirstPage=function(){return this.page=0,this.__getPage(1)},i.getNextPage=function(){return this.__getPage(1)},i.getPreviousPage=function(){return this.__getPage(-1)},i.updateTransportMethod=function(){console.log("Only for compatible")},i.signTransaction=function(t,e,r){var i=this;return new Promise((function(a,o){i.unlock().then((function(s){var u;e.v=n.bufferToHex(e.getChainId()),e.r="0x00",e.s="0x00",u=i._isLedgerLiveHdPath()?i._getPathForIndex(r):i._toLedgerPath(i._pathFromAddress(t)),i._sendMessage({action:"ledger-sign-transaction",params:{tx:e.serialize().toString("hex"),hdPath:u,to:n.bufferToHex(e.to).toLowerCase()}},(function(t){var r=t.payload;t.success?(e.v=Buffer.from(r.v,"hex"),e.r=Buffer.from(r.r,"hex"),e.s=Buffer.from(r.s,"hex"),a(e)):o(new Error(r.error||"Ledger: Unknown error while signing transaction"))}))})).catch((function(t){throw t}))}))},i._setupIframe=function(){this.iframe=document.createElement("iframe"),this.iframe.src=this.bridgeUrl,document.head.appendChild(this.iframe)},i._getOrigin=function(){var t=this.bridgeUrl.split("/");return t.splice(-1,1),t.join("/")},i._sendMessage=function(t,e){var r=this;t.target="LEDGER-IFRAME",this.iframe.contentWindow.postMessage(t,"*"),window.addEventListener("message",(function n(i){var a=i.data;if(i.origin!==r._getOrigin())return!1;a&&a.action&&a.action===t.action+"-reply"&&e?e(a):window.removeEventListener("message",n)}))},i.__getPage=function(){var t=u(h.mark((function t(e){var r,n,i;return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.page+=e,this.page<=0&&(this.page=1),n=(r=(this.page-1)*this.perPage)+this.perPage,t.next=6,this.unlock();case 6:if(!this._isLedgerLiveHdPath()){t.next=12;break}return t.next=9,this._getAccountsBIP44(r,n);case 9:i=t.sent,t.next=13;break;case 12:i=this._getAccountsLegacy(r,n);case 13:return t.abrupt("return",i);case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i._getAccountsBIP44=function(){var t=u(h.mark((function t(e,r){var n,i,a,o,s;return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],i=e;case 2:if(!(i<r)){t.next=21;break}return a=this._getPathForIndex(i),t.next=6,this.unlock(a);case 6:if(o=t.sent,!this.implementFullBIP44){t.next=13;break}return t.next=10,this._hasPreviousTransactions(o);case 10:t.t0=t.sent,t.next=14;break;case 13:t.t0=!0;case 14:if(s=t.t0,n.push({address:o,balance:null,index:i}),s){t.next=18;break}return t.abrupt("break",21);case 18:i++,t.next=2;break;case 21:return t.abrupt("return",n);case 22:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}(),i._getAccountsLegacy=function(t,e){for(var r=[],i=t;i<e;i++){var a=this._addressFromIndex("m",i);r.push({address:a,balance:null,index:i}),this.paths[n.toChecksumAddress(a)]=i}return r},i._padLeftEven=function(t){return t.length%2==0?t:"0"+t},i._normalize=function(t){return this._padLeftEven(n.bufferToHex(t).toLowerCase())},i._addressFromIndex=function(t,e){var r=this.hdk.derive(t+"/"+e),i=n.publicToAddress(r.publicKey,!0).toString("hex");return n.toChecksumAddress("0x"+i)},i._pathFromAddress=function(t){var e=n.toChecksumAddress(t),r=this.paths[e];if(void 0===r)for(var i=0;i<1e3;i++)if(e===this._addressFromIndex("m",i)){r=i;break}if(void 0===r)throw new Error("Unknown address");return this._getPathForIndex(r)},i._toAscii=function(t){var e="",r=0,n=t.length;for("0x"===t.substring(0,2)&&(r=2);r<n;r+=2){var i=parseInt(t.substr(r,2),16);e+=String.fromCharCode(i)}return e},i._getPathForIndex=function(t){return this._isLedgerLiveHdPath()?"m/44'/60'/"+t+"'/0/0":this.hdPath+"/"+t},i._isLedgerLiveHdPath=function(){return"m/44'/60'/0'/0/0"===this.hdPath},i._toLedgerPath=function(t){return t.toString().replace("m/","")},i._hasPreviousTransactions=function(){var t=u(h.mark((function t(e){var r,n,i;return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._getApiUrl(),t.next=3,window.fetch(r+"/api?module=account&action=txlist&address="+e+"&tag=latest&page=1&offset=1");case 3:return n=t.sent,t.next=6,n.json();case 6:if(!("0"!==(i=t.sent).status&&i.result.length>0)){t.next=9;break}return t.abrupt("return",!0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i._getApiUrl=function(){return p[this.network]||p.mainnet},e}(e.EventEmitter);d.type=f;var l=function(){function t(){}var e=t.prototype;return e.makeApp=function(){var t=u(h.mark((function t(){return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i.create();case 3:this.transport=t.sent,this.app=new a(this.transport),t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(0),console.log("LEDGER:::CREATE APP ERROR",t.t0),t.t0;case 11:case"end":return t.stop()}}),t,this,[[0,7]])})));return function(){return t.apply(this,arguments)}}(),e.cleanUp=function(){var t=u(h.mark((function t(){return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.app=null,!this.transport){t.next=4;break}return t.next=4,this.transport.close();case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e.unlock=function(){var t=u(h.mark((function t(e){return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.makeApp();case 3:return t.next=5,this.app.getAddress(e,!1,!0);case 5:return t.abrupt("return",t.sent);case 8:return t.prev=8,t.t0=t.catch(0),t.abrupt("return",Promise.reject(this.ledgerErrToMessage(t.t0)));case 11:return t.prev=11,t.next=14,this.cleanUp();case 14:return t.finish(11);case 15:case"end":return t.stop()}}),t,this,[[0,8,11,15]])})));return function(e){return t.apply(this,arguments)}}(),e.signTransaction=function(){var t=u(h.mark((function t(e,r,n){var i;return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.makeApp();case 3:if(!n){t.next=8;break}if(!(i=o.byContractAddress(n))){t.next=8;break}return t.next=8,this.app.provideERC20TokenInformation(i);case 8:return t.next=10,this.app.signTransaction(e,r);case 10:return t.abrupt("return",t.sent);case 13:return t.prev=13,t.t0=t.catch(0),t.abrupt("return",Promise.reject(this.ledgerErrToMessage(t.t0)));case 16:return t.prev=16,t.next=19,this.cleanUp();case 19:return t.finish(16);case 20:case"end":return t.stop()}}),t,this,[[0,13,16,20]])})));return function(e,r,n){return t.apply(this,arguments)}}(),e.signPersonalMessage=function(){var t=u(h.mark((function t(e,r){return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.makeApp();case 3:return t.next=5,this.app.signPersonalMessage(e,r);case 5:return t.abrupt("return",t.sent);case 8:return t.prev=8,t.t0=t.catch(0),t.abrupt("return",Promise.reject(this.ledgerErrToMessage(t.t0)));case 11:return t.prev=11,this.cleanUp(),t.finish(11);case 14:case"end":return t.stop()}}),t,this,[[0,8,11,14]])})));return function(e,r){return t.apply(this,arguments)}}(),e.ledgerErrToMessage=function(t){var e;return e=t,Boolean(e)&&Boolean(e.metaData)?5===t.metaData.code?"LEDGER_TIMEOUT":t.metaData.type:function(t){return String(t.message||t).includes("6804")}(t)?"LEDGER_WRONG_APP":function(t){return t.message&&t.message.includes("OpenFailed")}(t)||function(t){return"string"==typeof t}(t)&&t.includes("6801")?"LEDGER_LOCKED":function(t){return t.hasOwnProperty("id")&&t.hasOwnProperty("message")}(t)&&t.message.includes("U2F not supported")?"U2F_NOT_SUPPORTED":t.toString()},t}(),g={ropsten:"http://api-ropsten.etherscan.io",kovan:"http://api-kovan.etherscan.io",rinkeby:"https://api-rinkeby.etherscan.io",mainnet:"https://api.etherscan.io"},v=function(t){function e(e){var n;return void 0===e&&(e={}),(n=t.call(this)||this).accountDetails={},n.type="Ledger Hardware",n.page=0,n.perPage=5,n.unlockedAccount=0,n.hdk=new r,n.paths={},n.network="mainnet",n.implementFullBIP44=!1,n.deserialize(e),n.bridge=new l,n}c(e,t);var i=e.prototype;return i.serialize=function(){return Promise.resolve({hdPath:this.hdPath,accounts:this.accounts,accountDetails:this.accountDetails,implementFullBIP44:!1})},i.deserialize=function(t){var e=this;return void 0===t&&(t={}),this.hdPath=t.hdPath||"m/44'/60'/0'",this.accounts=t.accounts||[],this.accountDetails=t.accountDetails||{},this.implementFullBIP44=t.implementFullBIP44||!1,this.accounts=this.accounts.filter((function(t){return Object.keys(e.accountDetails).includes(n.toChecksumAddress(t))})),Promise.resolve()},i.isUnlocked=function(){return Boolean(this.hdk&&this.hdk.publicKey)},i.setAccountToUnlock=function(t){this.unlockedAccount=parseInt(t,10)},i.setHdPath=function(t){this.hdPath!==t&&(this.hdk=new r),this.hdPath=t},i.unlock=function(t){var e=this;if(this.isUnlocked()&&!t)return Promise.resolve("already unlocked");var r=t?this._toLedgerPath(t):this.hdPath;return this.bridge.unlock(r).then((function(t){return e.hdk.publicKey=Buffer.from(t.publicKey,"hex"),e.hdk.chainCode=Buffer.from(t.chainCode,"hex"),t.address}))},i.getFirstPage=function(){return this.page=0,this.__getPage(1)},i.getNextPage=function(){return this.__getPage(1)},i.getPreviousPage=function(){return this.__getPage(-1)},i.updateTransportMethod=function(){console.log("Only for compatible")},i.signTransaction=function(t,e,r){var i=this;return this.unlock().then((function(a){var o;return e.v=n.bufferToHex(e.getChainId()),e.r="0x00",e.s="0x00",o=i._isLedgerLiveHdPath()?i._getPathForIndex(r):i._toLedgerPath(i._pathFromAddress(t)),i.bridge.signTransaction(o,e.serialize().toString("hex"),n.bufferToHex(e.to).toLowerCase()).then((function(t){return e.v=Buffer.from(t.v,"hex"),e.r=Buffer.from(t.r,"hex"),e.s=Buffer.from(t.s,"hex"),e}))}))},i.__getPage=function(){var t=u(h.mark((function t(e){var r,n,i;return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.page+=e,this.page<=0&&(this.page=1),n=(r=(this.page-1)*this.perPage)+this.perPage,t.next=6,this.unlock();case 6:if(!this._isLedgerLiveHdPath()){t.next=12;break}return t.next=9,this._getAccountsBIP44(r,n);case 9:i=t.sent,t.next=13;break;case 12:i=this._getAccountsLegacy(r,n);case 13:return t.abrupt("return",i);case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i._getAccountsBIP44=function(){var t=u(h.mark((function t(e,r){var n,i,a,o,s;return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],i=e;case 2:if(!(i<r)){t.next=21;break}return a=this._getPathForIndex(i),t.next=6,this.unlock(a);case 6:if(o=t.sent,!this.implementFullBIP44){t.next=13;break}return t.next=10,this._hasPreviousTransactions(o);case 10:t.t0=t.sent,t.next=14;break;case 13:t.t0=!0;case 14:if(s=t.t0,n.push({address:o,balance:null,index:i}),s){t.next=18;break}return t.abrupt("break",21);case 18:i++,t.next=2;break;case 21:return t.abrupt("return",n);case 22:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}(),i._getAccountsLegacy=function(t,e){for(var r=[],i=t;i<e;i++){var a=this._addressFromIndex("m",i);r.push({address:a,balance:null,index:i}),this.paths[n.toChecksumAddress(a)]=i}return r},i._padLeftEven=function(t){return t.length%2==0?t:"0"+t},i._normalize=function(t){return this._padLeftEven(n.bufferToHex(t).toLowerCase())},i._addressFromIndex=function(t,e){var r=this.hdk.derive(t+"/"+e),i=n.publicToAddress(r.publicKey,!0).toString("hex");return n.toChecksumAddress("0x"+i)},i._pathFromAddress=function(t){var e=n.toChecksumAddress(t),r=this.paths[e];if(void 0===r)for(var i=0;i<1e3;i++)if(e===this._addressFromIndex("m",i)){r=i;break}if(void 0===r)throw new Error("Unknown address");return this._getPathForIndex(r)},i._toAscii=function(t){var e="",r=0,n=t.length;for("0x"===t.substring(0,2)&&(r=2);r<n;r+=2){var i=parseInt(t.substr(r,2),16);e+=String.fromCharCode(i)}return e},i._getPathForIndex=function(t){return this._isLedgerLiveHdPath()?"m/44'/60'/"+t+"'/0/0":this.hdPath+"/"+t},i._isLedgerLiveHdPath=function(){return"m/44'/60'/0'/0/0"===this.hdPath},i._toLedgerPath=function(t){return t.toString().replace("m/","")},i._hasPreviousTransactions=function(){var t=u(h.mark((function t(e){var r,n,i;return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._getApiUrl(),t.next=3,window.fetch(r+"/api?module=account&action=txlist&address="+e+"&tag=latest&page=1&offset=1");case 3:return n=t.sent,t.next=6,n.json();case 6:if(!("0"!==(i=t.sent).status&&i.result.length>0)){t.next=9;break}return t.abrupt("return",!0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i._getApiUrl=function(){return g[this.network]||g.mainnet},e}(e.EventEmitter);v.type="Ledger Hardware";var m=/chrome/i.test(window.navigator.userAgent);module.exports=m?v:d;
//# sourceMappingURL=bsc-ledger-bridge-keyring.cjs.production.min.js.map
